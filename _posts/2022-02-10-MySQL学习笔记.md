数据库连接

连接到数据库的指令：

```shell
mysql -h 主机IP -P 端口 -u 用户名 -p密码

mysql -h localhost -u root -p
```

* -p密码不要有空格
* -p后面没有写密码，回车会要求输入密码
* 如果没有写-h主机，默认就是本机
* 如果没写-P端口，默认就是3306



### 创建数据库

```sql
CREATE DATABASE db03;

DROP DATABASE db03

#创建一个使用utf8字符集的db03数据库
CREATE DATABASE db01 CHARACTER SET utf8
#创建一个使用uft8字符集，并待校对规则的db02数据库
CREATE DATABASE db02 CHARACTER SET utf8 COLLATE utf8_bin
#校对规则 utf8_bin 区分大小写，默认utf8_general_ci 不区分大小写

SELECT * FROM t1 WHERE NAME = 'Tom'
#查看当前数据库服务器中的所有数据库
SHOW DATABASES
#查看之前创建的数据库的定义信息
SHOW CREATE DATABASE db01

#反引号可以创建按关键字名称的数据库
CREATE DATABASE `create`
DROP DATABASE `create`
```



### 备份恢复数据库

```sql
#备份数据库(注意: 在DOS执行)命令行
mysqldump -u 用户名 -p -B 数据库1 数据库2 数据库n > 文件名（可以添加路径）.sql
#备份表
mysqldump -u 用户名 -p(密码) 数据库 表1 表2 表n > 文件名（可以添加路径）.sql
#恢复数据库，其实就是读取sql备份文件(注意： 进入Mysql命令行再执行)
Source 文件名.sql
```

所谓恢复其实就是将备份的`sql`文件里的所有`SQL`指令执行一遍



### 创建表

```sql
CREATE TABLE `user`(
	id INT,
	`name` VARCHAR(255),
	`password` VARCHAR(32),
	`birthday` DATE)
CHARACTER SET utf8 COLLATE utf8_bin ENGINE INNODB
```



### 列类型

1. 数值类型：

   <img src="https://s2.loli.net/2022/03/01/o5nqT6J8MHOg4iR.png" alt="image-20210912000945238" style="zoom:50%;" />

2. 文本类型（字符串类型）：

   <img src="https://s2.loli.net/2022/03/01/gwkdZRfh71M9OUS.png" alt="image-20210912001116614" style="zoom:50%;" />

3. 二进制数据类型

   <img src="https://s2.loli.net/2022/03/01/Nip53JvZPnboxX9.png" alt="image-20210912001330626-16313768117614" style="zoom: 67%;" />

4. 日期类型

   <img src="https://s2.loli.net/2022/03/01/R5CGUr6HoYZyKmF.png" alt="image-20210912001753675" style="zoom:50%;" />

### 整数类型

```sql
#如果没有指定unsigned,则TINYINT就是有符号
CREATE TABLE t3(
	id TINYINT UNSIGNED);

INSERT INTO t3 VALUES(-123);

SELECT * FROM t3
```





### 增删改查

数据表的基础操作(我自己理解为字段的属性)

```sql
auto_increment :自动增长
not null :表示不为空
primary key :表示主键
default :默认值
```

#### 增

添加数据库：

```sql
#查看当前数据库服务器中的所有数据库
show databases;

create database school charset=utf8;
#查看之前创建的数据库的定义信息
show create database school;
```

创建表：

```sql
use school;
show tables;
create table student(
    id int unsigned not null auto_increment primary key,
    name varchar(50) not null default "张三",
    age tinyint unsigned not null default 18,
    high decimal(5,2) not null,
    gender enum("男", "女", "保密")default "保密",
    cls_id int unsigned not null);
-- 查看创建表的语句
show create table student;
```

字段增：

```sql
alter table student add birth datetime;  #增加一个字段可以简单理解为表增加一个新列
```

数据增：

```sql
#一次插入一条完整信息，主键可以用 0 null default来占位
insert into student values(para1,para2,para3,para4,para5); #para为该表的所有列
#部分插入
insert into student(high) values(172);#插入部分字段的前提是没有插入的字段要有自己的默认值
#多行插入
insert into student(name,high) values("Mike",183),('Jane',163);
```

#### 删

删库：

```sql
drop database school;
```

删表：

```sql
use school;  #进入数据库
show tables;  #查看当前表
drop table student;
```

删字段：

```sql
desc student; #查看表的字段
alter table student drop high #删除high字段
desc student;
```

删数据：

```sql
delete from student where id=6;#这里删除之后id并不会重新排序，也就是id=5后面紧跟着就是id=7，id=6这条数据没了
```

#### 改

改字段：

```sql
#改字段属性
alter table student modify birth date;  #这里可以一次修改改字段的多个属性，但前提是修改后不得与表中已有信息冲突。
alter table student modify cls_id tinyint unsigned default 1; 
#可同时更改字段属性和名字
alter table student change birth birthday date default "2020-01-01";
```

改数据：

```sql
update students set age = 18 where id>=1 and id<=3;
```

#### 查

查数据库:

```sql
show database;
```

查表：

```sql
show tables;
```

查字段：

```sql
desc student;
```

查数据:

```sql
# as,where,%,_,逻辑语句,distinct,s.
# as的使用
select name as 姓名, age as 年龄 from student;        #给字段起别名且用别名显示
#s.
select s.name, s.age from student as s;  
select s.name as 姓名, s.age as 年龄 from student as s;
#where 逻辑语句
select * from student where age>=17 and age<=27;
select * from student where age>=13 or high>=159;
select * from student where not(age<=17 and gender=2);

-- 模糊查询
-- 查询以"李"开头的所有名字
select * from student where name like "李%";
-- 查询以"王"字结尾的所有名字
select * from student where name like "%王";
-- 查询有"三"的所有名字
select * from student where name like "%三%";
-- 查询有两个字的名字
select * from student where name like "__";
-- 查询有三个字的名字
select * from student where name like "___";
-- 查询至少有两个的名字
select * from student where name like "%__%";

-- 空判断is null
select * from student where high is null;

-- 利用distinct字段消除重复行
select distinct gender from student;
```



#### 排序

```sql
-- 查询students表中,按high 降序, age升序。优先拍前面的，这里优先high。
select * from student where(age between 19 and 20) and gender=2 order by high desc ,age asc;
-- 这里的between 19 and 20等价于age>=19 and age<=20
```



#### 聚合函数

```sql
-- 聚合函数常用的有count,max,min,sum,avg共五个
-- count(*)统计列数,count(字段)一样
select count(*) from student where gender=2;

-- 最大值,最小值,求和,平均
select max(age), min(age),sum(age),avg(age) from student;
```



#### 分组

```sql
-- group by + having :用来分组查询后指定一些条件的查询结果
select gender,group_concat(name),count(*) from students group by gender having count(*)>2;
#需要注意的是，group by的字段，在前面一定要有，且不可省略，如上例的gender。

+--------+--------------------+----------+
| gender | group_concat(name) | count(*) |
+--------+--------------------+----------+
| 男     | Mike,LiLong,LiLin  |        3 |
+--------+--------------------+----------+
```

​                                     

#### 分页

```sql
#limit n,m实现的是在最终筛选出来的所有结果中选出其中的[n,m)行
select gender, group_concat(name) from student group by gender limit 0,3;
```

​     

#### 连接查询

连接查询分为：内连接，左连接，右连接。

* 内连接：两个表均只返回两个表的交集部分；
* 左连接：第一个表返回全集，第二个表返回交集部分；
* 右连接：第一个返回交集部分，第二个表返回全集；

​     <img src="https://s2.loli.net/2022/03/02/lMvfYJQGCzaKHk1.png" alt="image-20220302155837051" style="zoom: 80%;" />                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    

![image-20220302160036909](https://s2.loli.net/2022/03/02/2pfDlFvP9wzLhca.png)  ![image-20220302160107372](https://s2.loli.net/2022/03/02/FSH9xuvnQtNVAPB.png)![image-20220302160129438](https://s2.loli.net/2022/03/02/YXjzd9ZKSuJcLbw.png)                

上图分别为内、左、右连接。

```sql
#其语法为： from table1 inner join table2 on 条件

-- 先建立一个班级表
-- 内连接查询班级表和学生表
select * from students inner join classes on students.cls_id=classes.id;

-- 左连接查询班级表和学生表
select * from students as s left join classes as c on c.cls_id=c.id;

-- 右连接查询班级表和学生表
select * from students as s right join classes as c on s.cls_id=c.id;
```



补充一个全连接

全连接分为两种：

* union：将两个表组成全集，且相同的key-value合并；
* union all：将两个表组成全集，相同的不合并。

```sql
# 语法为：(select col1,col2 from table1) union(或者union all)  (select col1,col2 from table2)
```

>支持表的自关联，即表的一列关联该表的另一列。



#### 子查询

```sql
-- 在一个select语句中,嵌入另外一个select语句,那么嵌入的select语句被称为子查询语句
-- 子查询是嵌入到主查询中
-- 子查询是辅助主查询的,要么充当条件,要么充当数据源
-- 子查询是可以独立存在的语句,是一条完整的 select 语句

-- 标准子查询
select * from students where age > (select avg(age) from students);

-- 列级子查询
select name from classes where id in (select id from students);

-- 行级子查询
select * from students where (height,age) = (select max(height),max(age) from students);
```



#### 事务

```sql
ACID原则
1.原子性
一个事务必须被视为一个不可分割的最小工作单元，整个事务中的所有操作要么全部提交成功，要么全部失败回滚，对于一个事务来说，不可能只执行其中的一部分操作，这就是事务的原子性

2.一致性
数据库总是从一个一致性的状态转换到另一个一致性的状态。（在前面的例子中，一致性确保了，即使在执行第三、四条语句之间时系统崩溃，支票账户中也不会损失200美元，因为事务最终没有提交，所以事务中所做的修改也
不会保存到数据库中。）

3.隔离性
通常来说，一个事务所做的修改在最终提交以前，对其他事务是不可见的。（在前面的例子中，当执行完第三条语句、第四条语句还未开始时，此时有另外的一个账户汇总程序开始运行，则其看到支票帐户的余额并没有被减去200美元。）

4.持久性
一旦事务提交，则其所做的修改会永久保存到数据库。（此时即使系统崩溃，修改的数据也不会丢失。）

-- 开启事务
begin;
start transaction;

-- 提交事务
commit;

-- 回滚事务
rollback;
```



#### 索引

```sql
索引是一种特殊的文件(InnoDB数据表上的索引是表空间的一个组成部分)，它们包含着对数据表里所有记录的引用指针。

更通俗的说，数据库索引好比是一本书前面的目录，能加快数据库的查询速度(创建索引会缩短执行的时间)

-- 查看索引
show index from 表名;

--创建索引
create index 索引名称 on 表名(字符段名称(长度))

--删除索引:
drop index 索引名称 on 表名;

--查询
--开启运行时间
set profiling=1;

--查看执行时间
show profiles;
```



#### 视图



### 账户管理

#### 用户管理

```sql
use mysql;        #进mysql数据库

SELECT HOST,USER FROM USER;    #查看目前的用户

创建用户
    create user '用户名'@'IP地址' identified by '密码';

实例：create user 'zx'@'%' identified by '111';
账户名zx，ip地址任意（可以在任意ip下访问），密码‘’111‘’可以使用该用户

删除用户
    drop user '用户名'@'IP地址';
修改用户
    rename user '用户名'@'IP地址' to '新用户名'@'IP地址';
修改密码
    set password for '用户名'@'IP地址' = Password('新密码')
    
    
忘记密码
# 启动免授权服务端
mysqld --skip-grant-tables

# 客户端
mysql -u root -p

# 修改用户名密码
update mysql.user set authentication_string=password('666') where user='root';
flush privileges;
```

#### 授权管理

```sql
查看权限：   show grantsfor '用户'@'IP地址'                               

授权：     grant 权限 on 数据库.表 to '用户'@'IP地址'         

取消权限：   revoke 权限 on 数据库.表from '用户'@'IP地址'
```

```sql
实例：

show grants for 'zx'@'%';

grant select on *.* to 'zx'@'%';

grant all privileges on *.* to 'zx'@'%';

revoke select on *.* from 'zx'@'%';

revoke all privileges on *.* from 'zx'@'%';
```

